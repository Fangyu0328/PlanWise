{"ast":null,"code":"import axios from 'axios';\nconst API_ENDPOINT = 'https://api.openai.com/v1/chat/completions';\nconst API_KEY = process.env.REACT_APP_OPENAI_API_KEY;\nconst client = axios.create({\n  baseURL: API_ENDPOINT,\n  headers: {\n    'Content-Type': 'application/json',\n    Authorization: `Bearer ${API_KEY}`\n  }\n});\n\n/**\n * 调用 OpenAI 生成最优排程\n */\nexport async function optimizeTaskSchedule(tasks, events, preferences) {\n  const formattedPrefs = {\n    workingHours: {\n      start: preferences.workingHours.start,\n      end: preferences.workingHours.end\n    },\n    maxTasksPerDay: preferences.maxTasksPerDay,\n    breakBetweenTasks: preferences.breakBetweenTasks,\n    splitTaskThreshold: preferences.splitTaskThreshold\n  };\n  const systemPrompt = `\nYou are a smart scheduling assistant. Create a balanced, human-friendly schedule blending Work, Exercise, and Leisure within the user's working hours.\n\nRULES:\n1. Do NOT overlap tasks or existing events.\n2. Finish each before its deadline.\n3. Prioritize high-priority tasks but balance daily load.\n4. Working hours: ${formattedPrefs.workingHours.start}–${formattedPrefs.workingHours.end}.\n5. Include ${formattedPrefs.breakBetweenTasks}-minute breaks.\n\nBALANCE:\n- After up to 2h of WORK, insert 30–60m of EXERCISE or LEISURE.\n- No single category >⅔ of daily working time.\n- Split tasks >${formattedPrefs.splitTaskThreshold}h naturally.\n- Max ${formattedPrefs.maxTasksPerDay} tasks/day.\n- Aim for a smooth morning/afternoon rhythm.\n\nOutput a JSON array:\n[\n  {\n    \"id\": \"...\",\n    \"title\": \"...\",\n    \"start\": \"ISO\",\n    \"end\":   \"ISO\",\n    \"categoryId\": \"...\",\n    \"categoryName\": \"...\",\n    \"notes\": \"e.g. 'Exercise Break'\"\n  },\n  ...\n]\n`;\n  const userPrompt = JSON.stringify({\n    tasks,\n    events,\n    preferences: formattedPrefs\n  });\n  const res = await client.post('', {\n    model: 'gpt-4',\n    temperature: 0.2,\n    max_tokens: 1500,\n    messages: [{\n      role: 'system',\n      content: systemPrompt\n    }, {\n      role: 'user',\n      content: userPrompt\n    }]\n  });\n  return res.data.choices[0].message.content;\n}\nexport default {\n  optimizeTaskSchedule\n};","map":{"version":3,"names":["axios","API_ENDPOINT","API_KEY","process","env","REACT_APP_OPENAI_API_KEY","client","create","baseURL","headers","Authorization","optimizeTaskSchedule","tasks","events","preferences","formattedPrefs","workingHours","start","end","maxTasksPerDay","breakBetweenTasks","splitTaskThreshold","systemPrompt","userPrompt","JSON","stringify","res","post","model","temperature","max_tokens","messages","role","content","data","choices","message"],"sources":["/Users/fiona/Desktop/Y/575/PlanWise/client/src/Services/openAIservice.js"],"sourcesContent":["import axios from 'axios';\n\nconst API_ENDPOINT = 'https://api.openai.com/v1/chat/completions';\nconst API_KEY      = process.env.REACT_APP_OPENAI_API_KEY;\n\nconst client = axios.create({\n  baseURL: API_ENDPOINT,\n  headers: {\n    'Content-Type':  'application/json',\n    Authorization:   `Bearer ${API_KEY}`\n  }\n});\n\n/**\n * 调用 OpenAI 生成最优排程\n */\nexport async function optimizeTaskSchedule(tasks, events, preferences) {\n  const formattedPrefs = {\n    workingHours: {\n      start: preferences.workingHours.start,\n      end:   preferences.workingHours.end\n    },\n    maxTasksPerDay:     preferences.maxTasksPerDay,\n    breakBetweenTasks:  preferences.breakBetweenTasks,\n    splitTaskThreshold: preferences.splitTaskThreshold\n  };\n\n  const systemPrompt = `\nYou are a smart scheduling assistant. Create a balanced, human-friendly schedule blending Work, Exercise, and Leisure within the user's working hours.\n\nRULES:\n1. Do NOT overlap tasks or existing events.\n2. Finish each before its deadline.\n3. Prioritize high-priority tasks but balance daily load.\n4. Working hours: ${formattedPrefs.workingHours.start}–${formattedPrefs.workingHours.end}.\n5. Include ${formattedPrefs.breakBetweenTasks}-minute breaks.\n\nBALANCE:\n- After up to 2h of WORK, insert 30–60m of EXERCISE or LEISURE.\n- No single category >⅔ of daily working time.\n- Split tasks >${formattedPrefs.splitTaskThreshold}h naturally.\n- Max ${formattedPrefs.maxTasksPerDay} tasks/day.\n- Aim for a smooth morning/afternoon rhythm.\n\nOutput a JSON array:\n[\n  {\n    \"id\": \"...\",\n    \"title\": \"...\",\n    \"start\": \"ISO\",\n    \"end\":   \"ISO\",\n    \"categoryId\": \"...\",\n    \"categoryName\": \"...\",\n    \"notes\": \"e.g. 'Exercise Break'\"\n  },\n  ...\n]\n`;\n\n  const userPrompt = JSON.stringify({ tasks, events, preferences: formattedPrefs });\n\n  const res = await client.post('', {\n    model:       'gpt-4',\n    temperature: 0.2,\n    max_tokens:  1500,\n    messages: [\n      { role: 'system', content: systemPrompt },\n      { role: 'user',   content: userPrompt }\n    ]\n  });\n\n  return res.data.choices[0].message.content;\n}\n\nexport default { optimizeTaskSchedule };\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,MAAMC,YAAY,GAAG,4CAA4C;AACjE,MAAMC,OAAO,GAAQC,OAAO,CAACC,GAAG,CAACC,wBAAwB;AAEzD,MAAMC,MAAM,GAAGN,KAAK,CAACO,MAAM,CAAC;EAC1BC,OAAO,EAAEP,YAAY;EACrBQ,OAAO,EAAE;IACP,cAAc,EAAG,kBAAkB;IACnCC,aAAa,EAAI,UAAUR,OAAO;EACpC;AACF,CAAC,CAAC;;AAEF;AACA;AACA;AACA,OAAO,eAAeS,oBAAoBA,CAACC,KAAK,EAAEC,MAAM,EAAEC,WAAW,EAAE;EACrE,MAAMC,cAAc,GAAG;IACrBC,YAAY,EAAE;MACZC,KAAK,EAAEH,WAAW,CAACE,YAAY,CAACC,KAAK;MACrCC,GAAG,EAAIJ,WAAW,CAACE,YAAY,CAACE;IAClC,CAAC;IACDC,cAAc,EAAML,WAAW,CAACK,cAAc;IAC9CC,iBAAiB,EAAGN,WAAW,CAACM,iBAAiB;IACjDC,kBAAkB,EAAEP,WAAW,CAACO;EAClC,CAAC;EAED,MAAMC,YAAY,GAAG;AACvB;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoBP,cAAc,CAACC,YAAY,CAACC,KAAK,IAAIF,cAAc,CAACC,YAAY,CAACE,GAAG;AACxF,aAAaH,cAAc,CAACK,iBAAiB;AAC7C;AACA;AACA;AACA;AACA,iBAAiBL,cAAc,CAACM,kBAAkB;AAClD,QAAQN,cAAc,CAACI,cAAc;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;EAEC,MAAMI,UAAU,GAAGC,IAAI,CAACC,SAAS,CAAC;IAAEb,KAAK;IAAEC,MAAM;IAAEC,WAAW,EAAEC;EAAe,CAAC,CAAC;EAEjF,MAAMW,GAAG,GAAG,MAAMpB,MAAM,CAACqB,IAAI,CAAC,EAAE,EAAE;IAChCC,KAAK,EAAQ,OAAO;IACpBC,WAAW,EAAE,GAAG;IAChBC,UAAU,EAAG,IAAI;IACjBC,QAAQ,EAAE,CACR;MAAEC,IAAI,EAAE,QAAQ;MAAEC,OAAO,EAAEX;IAAa,CAAC,EACzC;MAAEU,IAAI,EAAE,MAAM;MAAIC,OAAO,EAAEV;IAAW,CAAC;EAE3C,CAAC,CAAC;EAEF,OAAOG,GAAG,CAACQ,IAAI,CAACC,OAAO,CAAC,CAAC,CAAC,CAACC,OAAO,CAACH,OAAO;AAC5C;AAEA,eAAe;EAAEtB;AAAqB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}